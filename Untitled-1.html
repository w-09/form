<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>南一處-亞灣工地 施工人員進場登記</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background-color: #f4f4f4;
}
.container {
  max-width: 800px;
  margin: 0 auto;
  background-color: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
h1 {
  text-align: center;
  color: #333;
}
.time-display {
  text-align: center;
  margin-bottom: 15px;
  font-size: 18px;
  font-weight: bold;
  color: #666;
}
.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}
.form-group {
  margin-bottom: 10px;
}
label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}
input, select {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-sizing: border-box;
}
.btn {
  display: inline-block;
  padding: 10px 15px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-top: 10px;
}
.btn-danger {
  background-color: #f44336;
}
#personList {
  margin-top: 20px;
  border: 1px solid #ddd;
  padding: 10px;
  min-height: 100px;
}
.person-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background-color: #f9f9f9;
  margin-bottom: 10px;
  border-radius: 4px;
}
.statistics {
  display: flex;
  justify-content: space-around;
  margin-top: 20px;
  background-color: #f0f0f0;
  padding: 10px;
  border-radius: 4px;
}
.stat-item {
  text-align: center;
}
</style>
</head>
<body>
<div class="container">
<h1>工地施工人員進場登記</h1>

<div id="currentTime" class="time-display"></div>

<form id="personForm" class="form-grid">
  <div class="form-group">
    <label>工種</label>
    <select id="personType" required>
      <option value="">選擇工種</option>
      <option value="鋼筋工">鋼筋工</option>
      <option value="模板工">模板工</option>
      <option value="水電工">水電工</option>
      <option value="泥作工">泥作工</option>
      <option value="木工">木工</option>
      <option value="油漆工">油漆工</option>
      <option value="其他">其他</option>
    </select>
  </div>
  
  <div class="form-group">
    <label>工作位置</label>
    <select id="personLocation" required>
      <option value="">選擇工作位置</option>
      <option value="A棟">A棟</option>
      <option value="B棟">B棟</option>
      <option value="C棟">C棟</option>
      <option value="地下室">地下室</option>
      <option value="戶外工地">戶外工地</option>
    </select>
  </div>
  
  <div class="form-group">
    <label>施工內容</label>
    <input type="text" id="workContent" placeholder="簡述工作內容" required>
  </div>
  
  <div class="form-group">
    <label>人數</label>
    <input type="number" id="personCount" min="1" value="1" required>
  </div>
</form>

<button class="btn" onclick="addPerson()">新增施工人員</button>
<button class="btn btn-danger" onclick="clearAllPersons()">清除全部</button>

<div id="personList"></div>

<div class="statistics">
  <div class="stat-item">
    <strong>總人數</strong>
    <div id="totalPersons">0</div>
  </div>
  <div class="stat-item">
    <strong>工種統計</strong>
    <div id="typeStatistics"></div>
  </div>
  <div class="stat-item">
    <strong>位置統計</strong>
    <div id="locationStatistics"></div>
  </div>
</div>

<button class="btn" onclick="submitPersons()" style="width: 100%; margin-top: 20px;">提交所有施工人員</button>
</div>

<script>
let persons = [];

// 更新當前時間函數
function updateCurrentTime() {
  const now = new Date();
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  
  const timeString = `${hours}:${minutes}:${seconds}`;
  document.getElementById('currentTime').textContent = timeString;
}

// 頁面載入時初始化
document.addEventListener('DOMContentLoaded', function() {
  // 立即更新時間
  updateCurrentTime();
  
  // 每秒更新一次時間
  setInterval(updateCurrentTime, 1000);
});

function addPerson() {
  const type = document.getElementById('personType');
  const location = document.getElementById('personLocation');
  const content = document.getElementById('workContent');
  const count = document.getElementById('personCount');
  
  // 驗證所有欄位
  if (!type.value || !location.value || !content.value || !count.value) {
    alert('請填寫所有欄位');
    return;
  }
  
  // 建立施工人員物件
  const person = {
    type: type.value,
    location: location.value,
    content: content.value,
    count: parseInt(count.value),
    time: new Date().toLocaleTimeString()
  };
  
  // 加入施工人員列表
  persons.push(person);
  
  // 更新顯示
  updatePersonList();
  updateStatistics();
  
  // 清空輸入欄位
  type.selectedIndex = 0;
  location.selectedIndex = 0;
  content.value = '';
  count.value = '1';
}

function updatePersonList() {
  const list = document.getElementById('personList');
  list.innerHTML = persons.map((person, index) => `
    <div class="person-item">
      <div>
        <strong>${person.type}</strong> | 
        ${person.location} | 
        ${person.content} | 
        ${person.count}人 | 
        ${person.time}
      </div>
      <button onclick="removePerson(${index})" class="btn btn-danger" style="padding: 5px 10px;">刪除</button>
    </div>
  `).join('');
}

function removePerson(index) {
  persons.splice(index, 1);
  updatePersonList();
  updateStatistics();
}

function updateStatistics() {
  const totalPersons = document.getElementById('totalPersons');
  const typeStatistics = document.getElementById('typeStatistics');
  const locationStatistics = document.getElementById('locationStatistics');
  
  // 計算總人數
  const total = persons.reduce((sum, person) => sum + person.count, 0);
  totalPersons.textContent = total;
  
  // 工種統計
  const typeCount = persons.reduce((acc, person) => {
    acc[person.type] = (acc[person.type] || 0) + person.count;
    return acc;
  }, {});
  
  typeStatistics.innerHTML = Object.entries(typeCount)
    .map(([type, count]) => `${type}: ${count}人`).join('<br>');
    
  // 位置統計
  const locationCount = persons.reduce((acc, person) => {
    acc[person.location] = (acc[person.location] || 0) + person.count;
    return acc;
  }, {});
  
  locationStatistics.innerHTML = Object.entries(locationCount)
    .map(([location, count]) => `${location}: ${count}人`).join('<br>');
}

function clearAllPersons() {
  persons = [];
  updatePersonList();
  updateStatistics();
}

function submitPersons() {
  if (persons.length === 0) {
    alert('尚未新增任何施工人員');
    return;
  }
  
  // 計算總人數
  const totalCount = persons.reduce((sum, person) => sum + person.count, 0);
  
  // 這裡可以呼叫後端API或Google Apps Script處理
  console.log('提交施工人員資料:', persons);
  alert(`已提交 ${persons.length} 筆資料，共 ${totalCount} 人`);
  
  // 清空列表
  clearAllPersons();
}
</script>
</body>
</html>
