<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工地人員進場登記系統</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            padding-bottom: 70px;
        }
        .form-label {
            font-weight: bold;
        }
        .table th {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <!-- 頂部導航欄 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-building me-2"></i>工地人員進場登記系統
            </a>
        </div>
    </nav>

    <!-- 主要內容 -->
    <div class="container mt-4">
        <!-- 登記表單 -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">
                    <i class="bi bi-person-plus me-2"></i>新增人員
                </h5>
            </div>
            <div class="card-body">
                <form id="workerForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="workerType" class="form-label">工種</label>
                            <input type="text" class="form-control" id="workerType" required list="workerTypeList">
                            <datalist id="workerTypeList">
                                <option value="鋼筋工">
                                <option value="模板工">
                                <option value="水電工">
                                <option value="泥作工">
                                <option value="木工">
                                <option value="油漆工">
                                <option value="搬運工">
                            </datalist>
                        </div>
                        <div class="col-md-6">
                            <label for="workerCount" class="form-label">人數</label>
                            <input type="number" class="form-control" id="workerCount" min="1" value="1" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="workLocation" class="form-label">位置</label>
                            <input type="text" class="form-control" id="workLocation" required list="locationList">
                            <datalist id="locationList">
                                <option value="A棟">
                                <option value="B棟">
                                <option value="C棟">
                                <option value="地下室">
                                <option value="公共區域">
                            </datalist>
                        </div>
                        <div class="col-md-6">
                            <label for="entryTime" class="form-label">進場時間</label>
                            <input type="time" class="form-control" id="entryTime" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="workContent" class="form-label">工作內容</label>
                        <textarea class="form-control" id="workContent" rows="2" required></textarea>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i>新增
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 人員列表 -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-list-ul me-2"></i>人員列表
                </h5>
                <span class="badge bg-primary" id="workerCount">0</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0" id="workerTable">
                        <thead>
                            <tr>
                                <th>工種</th>
                                <th>人數</th>
                                <th>位置</th>
                                <th>工作內容</th>
                                <th>進場時間</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 資料將由 JavaScript 動態填充 -->
                        </tbody>
                    </table>
                </div>
                <div class="text-center py-3 d-none" id="emptyState">
                    <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
                    <p class="text-muted mt-2">尚無人員資料</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部固定工具欄 -->
    <nav class="navbar fixed-bottom bg-light">
        <div class="container-fluid">
            <div class="btn-group w-100" role="group">
                <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#clearDataModal">
                    <i class="bi bi-trash me-2"></i>清空資料
                </button>
                <button type="button" class="btn btn-success" id="uploadBtn" onclick="uploadToGoogleSheet()">
                    <i class="bi bi-cloud-arrow-up me-2"></i>上傳資料
                </button>
            </div>
        </div>
    </nav>

    <!-- 清空資料確認 Modal -->
    <div class="modal fade" id="clearDataModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">確認清空</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        確定要清空所有資料嗎？此操作無法復原。
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" onclick="clearAllData()">確認清空</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 上傳結果 Modal -->
    <div class="modal fade" id="uploadResultModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">上傳結果</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="uploadResultBody">
                    <!-- 內容將由 JavaScript 動態填充 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 自定義 JS -->
    <script>
        // 全局變數
        let workers = [];
        
        // 頁面載入時執行
        document.addEventListener('DOMContentLoaded', function() {
            // 設置當前時間為預設進場時間
            setDefaultEntryTime();
            
            // 註冊表單提交事件
            document.getElementById('workerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addWorker();
            });
            
            // 從 localStorage 載入資料
            loadWorkersFromLocalStorage();
            
            // 更新工人表格
            updateWorkerTable();
        });
        
        // 設置預設進場時間
        function setDefaultEntryTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('entryTime').value = `${hours}:${minutes}`;
        }
        
        // 添加工人
        function addWorker() {
            const workerType = document.getElementById('workerType').value;
            const workerCount = parseInt(document.getElementById('workerCount').value);
            const workLocation = document.getElementById('workLocation').value;
            const workContent = document.getElementById('workContent').value;
            const entryTime = document.getElementById('entryTime').value;
            
            // 添加到工人列表
            workers.push({
                type: workerType,
                count: workerCount,
                location: workLocation,
                content: workContent,
                entryTime: entryTime
            });
            
            // 更新表格
            updateWorkerTable();
            
            // 保存到 localStorage
            saveWorkersToLocalStorage();
            
            // 重置表單
            document.getElementById('workerForm').reset();
            setDefaultEntryTime();
            
            // 顯示成功提示
            showToast('新增成功');
        }
        
        // 更新工人表格
        function updateWorkerTable() {
            const tbod
